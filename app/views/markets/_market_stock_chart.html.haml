#market_chart{:style => "min-width: 400px; height: 655px; margin: 0 auto"}
:coffeescript
  $ ->
    $.getJSON "#{ data_market_path(@market.id) }", (data) ->

      # split the data set into ohlc and volume
      ohlc = []
      volume = []
      ema1 = []
      ema2 = []
      dmac = []
      dmacs = []
      dmach = []
      bidx = []
      dataLength = data.length

      for e in data
        ohlc.push [e[0], e[1]]
        # the date
        volume.push [e[0], e[2]] 
        ema1.push [e[0], e[3]] 
        ema2.push [e[0], e[4]] 
        dmac.push [e[0], e[5]] 
        dmacs.push [e[0], e[6]] 
        dmach.push [e[0], e[7]] 
        bidx.push [e[0], e[8]] 

      $("#market_chart").highcharts "StockChart",
        rangeSelector:
          selected: 3
          buttons: [
            type: 'hour',
            count: 4,
            text: '4h'
          ,
            type: 'hour',
            count: 8,
            text: '8h'
          ,
            type: 'hour',
            count: 12,
            text: '12h'
          ,
            type: 'day',
            count: 1,
            text: '1d'
          ,
            type: 'day',
            count: 2,
            text: '2d'
          ,
            type: 'day',
            count: 3,
            text: '3d'
          ,
            type: 'day',
            count: 5,
            text: '5d'
          ,
            type: 'month',
            count: 1,
            text: '1m'
          ,
            type: 'month',
            count: 6,
            text: '6m'
          ,
            type: 'year',
            count: 1,
            text: '1y'
          ,
            type: 'all',
            text: 'All'
          ]

        title:
          text: "#{@market.label}"

        subtitle:
          text: "Average Trading Price / Volume"


        yAxis: [
          title:
            text: "AVG TP"
          height: 200
          lineWidth: 2
        ,
          title:
            text: "MACD24/28/9"

          top: 290
          height: 100
          offset: 0
          lineWidth: 1
        ,
          title:
            text: "BIDX"
          top: 400
          height: 50
          offset: 0
          lineWidth: 2
        ,
          title:
            text: "Volume BTC"
          top: 460
          height: 100
          offset: 0
          lineWidth: 2
        ]

        tooltip: 
          valueDecimals: 8

        series: [
          type: "line"
          name: "#{@market.primary_currency_code}"
          data: ohlc
          yAxis: 0
          lineWidth: 2
        ,
          type: "line"
          name: "EMA 24 Short"
          data: ema1
          yAxis: 0
          lineWidth: 1
        ,
          type: "line"
          name: "EMA 48 Long"
          data: ema2
          yAxis: 0
          lineWidth: 1
        ,
          type: "line"
          name: "MACD24/48"
          data: dmac
          yAxis: 1
          lineWidth: 1
        ,
          type: "line"
          name: "MACDS9"
          data: dmacs
          lineWidth: 2
          yAxis: 1
        ,
          type: "line"
          name: "MACDH"
          data: dmach
          lineWidth: 1
          yAxis: 1
        ,
          type: "line"
          name: "BIDX"
          data: bidx
          lineWidth: 1
          yAxis: 2
        ,
          type: "column"
          name: "Volume BTC"
          data: volume
          yAxis: 3
        ]
